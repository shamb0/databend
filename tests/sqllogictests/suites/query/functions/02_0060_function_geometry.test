statement ok
DROP TABLE IF EXISTS t1

statement ok
SET geometry_output_format='EWKT'

query T
SELECT to_string(st_makeline(ST_GEOMFROMWKT('POINT(33.0 44.2)', 32633), ST_GEOMFROMWKT('POINT(224.5 41.5)', 32633)));
----
SRID=32633;LINESTRING(33 44.2,224.5 41.5)

statement ok
CREATE TABLE t1 (lat Float64, lon Float64) ENGINE=Memory

statement ok
INSERT INTO t1 VALUES(55.77922738, 37.63098076), (5.77922738, 7.63098076)

query T
SELECT to_string(st_makegeompoint(lat, lon)) FROM t1
----
POINT(55.77922738 37.63098076)
POINT(5.77922738 7.63098076)

query T
SELECT st_makegeompoint(lat, lon)::String FROM t1
----
POINT(55.77922738 37.63098076)
POINT(5.77922738 7.63098076)

statement ok
DROP TABLE IF EXISTS t1

statement error 1801
CREATE TABLE t1 (a int, g geometry)

statement ok
SET enable_geo_create_table=1

statement ok
CREATE TABLE t1 (a int, g geometry)

statement ok
INSERT INTO t1 VALUES(1, ST_GEOMFROMWKT('POINT(389866.35 5819003.03)', 32633)), (2, ST_GEOMFROMWKT('POINT(4.500212 52.161170)', 4326))

query T
SELECT a, to_string(g) FROM t1
----
1 SRID=32633;POINT(389866.35 5819003.03)
2 SRID=4326;POINT(4.500212 52.16117)

#query T
#SELECT ST_TRANSFORM(g, 3857) AS transformed_geom FROM t1
#----
#SRID=3857;POINT(1489140.0937656453 6892872.198680114)
#SRID=3857;POINT(500961.30830177927 6829319.683153116)

statement ok
DROP TABLE IF EXISTS t1

statement ok
CREATE TABLE t1 (a geometry)

statement ok
INSERT INTO t1 VALUES(ST_GEOMETRYFROMWKT('LINESTRING(0.0 0.0, 1.0 0.0, 1.0 2.0, 0.0 2.0, 0.0 0.0)')),(ST_GEOMETRYFROMWKT('LINESTRING(0.0 0.2, 1.4 5, 1.9 2, 0 2, 0.0 0.2)'))

statement ok
SET geometry_output_format='GeoJSON'

query T
SELECT to_string(st_makepolygon(a)) FROM t1
----
{"type": "Polygon", "coordinates": [[[0,0],[1,0],[1,2],[0,2],[0,0]]]}
{"type": "Polygon", "coordinates": [[[0,0.2],[1.4,5],[1.9,2],[0,2],[0,0.2]]]}

statement ok
DROP TABLE IF EXISTS t1

statement ok
CREATE TABLE t1 (g1 geometry, g2 geometry)

statement ok
INSERT INTO t1 VALUES(ST_GEOMFROMWKT('POINT(1.0 2.0)', 32633), ST_GEOMFROMWKT('POINT(3.5 4.5)', 32633)),
(ST_GEOMFROMWKT('POINT(1.0 2.0)', 4326), ST_GEOMFROMWKT('LINESTRING(1.0 2.0, 10.1 5.5)', 4326)),
(ST_GEOMFROMWKT('LINESTRING(1.0 2.0, 10.1 5.5)'), ST_GEOMFROMWKT('MULTIPOINT(3.5 4.5, 6.1 7.9)'))

statement ok
SET geometry_output_format='EWKT'

query T
SELECT to_string(st_makeline(g1, g2)) FROM t1
----
SRID=32633;LINESTRING(1 2,3.5 4.5)
SRID=4326;LINESTRING(1 2,1 2,10.1 5.5)
LINESTRING(1 2,10.1 5.5,3.5 4.5,6.1 7.9)

statement ok
DROP TABLE IF EXISTS t1;

statement ok
CREATE TABLE t1 (b binary);

statement ok
INSERT INTO t1 VALUES(UNHEX('0101000020797f000066666666a9cb17411f85ebc19e325641'));

statement ok
SET geometry_output_format='EWKT'

query T
SELECT TO_STRING(ST_GEOMETRYFROMWKB(b)) FROM t1;
----
SRID=32633;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(ST_GEOMETRYFROMWKB(b, 4326)) FROM t1;
----
SRID=4326;POINT(389866.35 5819003.03)

query T
SELECT ST_ASGEOJSON(ST_GEOMETRYFROMWKB(b)) FROM t1
----
{"coordinates":[389866.35,5819003.03],"type":"Point"}

statement ok
DROP TABLE IF EXISTS t1;

statement ok
CREATE TABLE t1 (b STRING);

statement ok
INSERT INTO t1 VALUES('0101000020797f000066666666a9cb17411f85ebc19e325641');

query T
SELECT TO_STRING(ST_GEOMETRYFROMWKB(b)) FROM t1;
----
SRID=32633;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(ST_GEOMETRYFROMWKB(b, 4326)) FROM t1;
----
SRID=4326;POINT(389866.35 5819003.03)

statement ok
DROP TABLE IF EXISTS t1;

query T
SELECT TO_STRING(ST_ASGEOJSON(ST_GEOMETRYFROMWKT('SRID=4326;LINESTRING(389866 5819003, 390000 5830000)')))
----
 {"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}

statement ok
SET geometry_output_format = 'GeoJSON'

query T
SELECT TO_STRING(ST_GEOMPOINTFROMGEOHASH('s02equ0'))
----
{"type": "Point", "coordinates": [1.0004425048828125,2.0001983642578125]}

statement ok
CREATE TABLE t1 (s varchar);

statement ok
INSERT INTO t1 VALUES('9q60y60rhs');

query T
SELECT TO_STRING(ST_GEOMFROMGEOHASH(s)) FROM t1;
----
{"type": "Polygon", "coordinates": [[[-120.66230535507202,35.30029535293579],[-120.66230535507202,35.30030071735382],[-120.66229462623596,35.30030071735382],[-120.66229462623596,35.30029535293579],[-120.66230535507202,35.30029535293579]]]}

statement ok
SET geometry_output_format = 'EWKT';

query T
SELECT TO_STRING(TO_GEOMETRY('POINT(1820.12 890.56)'));
----
POINT(1820.12 890.56)

query T
SELECT TO_STRING(TO_GEOMETRY('SRID=4326;POINT(1820.12 890.56)'))
----
SRID=4326;POINT(1820.12 890.56)

query T
SELECT TO_STRING(TO_GEOMETRY('POINT(1820.12 890.56)', 4326))
----
SRID=4326;POINT(1820.12 890.56)

query T
SELECT TO_STRING(TO_GEOMETRY('0101000020797f000066666666a9cb17411f85ebc19e325641'))
----
SRID=32633;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TO_GEOMETRY('0101000020797f000066666666a9cb17411f85ebc19e325641', 4326))
----
SRID=4326;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TO_GEOMETRY(UNHEX('0101000020797f000066666666a9cb17411f85ebc19e325641')))
----
SRID=32633;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TO_GEOMETRY(UNHEX('0101000020797f000066666666a9cb17411f85ebc19e325641'), 4326))
----
SRID=4326;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TO_GEOMETRY('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}'))
----
LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TO_GEOMETRY('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}', 4326))
----
SRID=4326;LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TO_GEOMETRY(PARSE_JSON('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}')))
----
LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TO_GEOMETRY(PARSE_JSON('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}'), 4326))
----
SRID=4326;LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('POINT(1820.12 890.56)'));
----
POINT(1820.12 890.56)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('SRID=4326;POINT(1820.12 890.56)'))
----
SRID=4326;POINT(1820.12 890.56)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('POINT(1820.12 890.56)', 4326))
----
SRID=4326;POINT(1820.12 890.56)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('0101000020797f000066666666a9cb17411f85ebc19e325641'))
----
SRID=32633;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('0101000020797f000066666666a9cb17411f85ebc19e325641', 4326))
----
SRID=4326;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(UNHEX('0101000020797f000066666666a9cb17411f85ebc19e325641')))
----
SRID=32633;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(UNHEX('0101000020797f000066666666a9cb17411f85ebc19e325641'), 4326))
----
SRID=4326;POINT(389866.35 5819003.03)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}'))
----
LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}', 4326))
----
SRID=4326;LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(PARSE_JSON('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}')))
----
LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(PARSE_JSON('{"coordinates":[[389866,5819003],[390000,5830000]],"type":"LineString"}'), 4326))
----
SRID=4326;LINESTRING(389866 5819003,390000 5830000)

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('abc'));
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(UNHEX('1234')))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(UNHEX('1234'), 4326))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('{}'))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('{"coordinates":[]', 4326))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(PARSE_JSON('{}')))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(PARSE_JSON('{"coordinates":[],"type":"aaa"}'), 4326))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY(NULL))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('nuLL'))
----
NULL

query T
SELECT TO_STRING(TRY_TO_GEOMETRY('null'))
----
NULL

statement ok
DROP TABLE IF EXISTS t1;

statement ok
CREATE OR REPLACE TABLE t1 (g geometry)

statement ok
INSERT INTO t1 VALUES
  ('POINT(-122.35 37.55)'), ('LINESTRING(0.75 0.75, -10 20)')

query T
SELECT UPPER(TO_HEX(ST_ASWKB(g))) FROM t1
----
01010000006666666666965EC06666666666C64240
010200000002000000000000000000E83F000000000000E83F00000000000024C00000000000003440

query T
SELECT ST_ASWKT(g) FROM t1
----
POINT(-122.35 37.55)
LINESTRING(0.75 0.75,-10 20)

statement ok
CREATE OR REPLACE TABLE t1 (g GEOMETRY)

statement ok
INSERT INTO t1 VALUES('SRID=4326;POINT(-122.35 37.55)'), ('SRID=0;LINESTRING(0.75 0.75, -10 20)')

query T
SELECT UPPER(TO_HEX(ST_ASEWKB(g))) FROM t1
----
0101000020E61000006666666666965EC06666666666C64240
01020000200000000002000000000000000000E83F000000000000E83F00000000000024C00000000000003440

# srid=0 has't supported by geozero crate.See also: https://github.com/georust/geozero/pull/210/files
query T
SELECT ST_ASEWKT(g) FROM t1
----
SRID=4326;POINT(-122.35 37.55)
LINESTRING(0.75 0.75,-10 20)

query T
SELECT ST_GEOHASH(TO_GEOMETRY('POINT(-122.306100 37.554162)', 4326))
----
9q9j8ue2v71y

query T
SELECT ST_GEOHASH(TO_GEOMETRY('POINT(-122.306100 37.554162)', 4326), 10)
----
9q9j8ue2v7

statement ok
SET geometry_output_format='WKT'

query T
SELECT TO_STRING(ST_ENDPOINT(TO_GEOMETRY('LINESTRING(1 1, 2 2, 3 3, 4 4)')));
----
POINT(4 4)

statement ok
CREATE OR REPLACE TABLE t1 (g GEOMETRY)

statement ok
INSERT INTO t1 VALUES
    ('POINT(66 12)'),
    ('MULTIPOINT((45 21), (12 54))'),
    ('LINESTRING(40 60, 50 50, 60 40)'),
    ('MULTILINESTRING((1 1, 32 17), (33 12, 73 49, 87.1 6.1))'),
    ('POLYGON((17 17, 17 30, 30 30, 30 17, 17 17))'),
    ('MULTIPOLYGON(((-10 0,0 10,10 0,-10 0)),((-10 40,10 40,0 20,-10 40)))'),
    ('GEOMETRYCOLLECTION(POLYGON((-10 0,0 10,10 0,-10 0)),LINESTRING(40 60, 50 50, 60 40), POINT(99 11))')

query T
SELECT ST_DIMENSION(g) FROM t1;
----
0
0
1
1
2
2
2

query T
SELECT TO_STRING(ST_POINTN(TO_GEOMETRY('LINESTRING(1 1, 2 2, 3 3, 4 4)'), 2))
----
POINT(2 2)

query T
SELECT TO_STRING(ST_POINTN(TO_GEOMETRY('LINESTRING(1 1, 2 2, 3 3, 4 4)'), -2))
----
POINT(3 3)


query T
SELECT ST_SRID(TO_GEOMETRY('POINT(-122.306100 37.554162)', 1234))
----
1234

query T
SELECT ST_SRID(ST_MAKEGEOMPOINT(37.5, 45.5))
----
4326

query T
SELECT ST_SRID(ST_MAKEGEOMPOINT(NULL, NULL))
----
NULL

query T
SELECT ST_SRID(NULL)
----
NULL

statement ok
SET enable_geo_create_table=0

statement ok
DROP TABLE IF EXISTS t1;